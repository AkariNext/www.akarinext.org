---
import { fetchOgp } from '../lib/ogp';

interface Props {
  url: string;
}

const { url } = Astro.props;

let data = null;
try {
  data = await fetchOgp(url);
} catch (e) {
  // Silent fail
}

const title = data?.ogTitle || data?.twitterTitle || url;
const desc = data?.ogDescription || data?.twitterDescription || '';
const image = data?.ogImage?.[0]?.url || data?.twitterImage?.[0]?.url || '';
const siteName = data?.ogSiteName || new URL(url).hostname;

const hasData = !!(data && (data.ogTitle || data.ogDescription));
---

{hasData ? (
  <a href={url} target="_blank" rel="noopener noreferrer" class="link-card-rich">
      <div class="link-card-text">
          <div class="link-card-meta">
              {image && <img src={image} alt="" class="link-card-favicon" />}
              <span>{siteName}</span>
          </div>
          <div class="link-card-title">{title}</div>
          {desc && <div class="link-card-desc">{desc}</div>}
      </div>
      {image && <div class="link-card-image" style={`background-image: url('${image}')`}></div>}
  </a>
) : (
  <a href={url} target="_blank" rel="noopener noreferrer" class="external-link">{title}</a>
)}

<style>
/* 
   Note: The styles for .link-card-rich are expected to be in global.css 
   to ensure consistency with auto-generated link cards in content.ts.
   We reuse the same classes here.
*/
</style>
